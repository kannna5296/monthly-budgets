# 月次家計予算（高レベル仕様）

作成日: 2026-02-07

このドキュメントはプロダクトやチームメンバー向けの高レベルな仕様を示します。実装の技術的な詳細（使用する言語、フレームワーク、データベースの種類など）は含めません。目的は「何を実現するか」を明確にすることです。

## 概要

ユーザが毎月の収入と貯金目標をもとに、固定費／変動費のカテゴリごとにベース予算と任意の補正予算（名目付き）を設定して月次予算を作成・保存できるアプリケーションです。実支出の管理は含みません。

主なポイント:
- 各月ごとに1つの「月次予算」を作成・保存する。既にその月の予算がある場合は上書き（編集）できる。  
- カテゴリはユーザが自由に追加・編集・削除でき、種別は「固定費」か「変動費」のいずれかであること。  
- 各カテゴリには「ベース予算」と任意の「補正（名目、金額）」を設定できる。  
- 月次予算は履歴として参照可能で、過去の内訳を確認できる。

UI 上の明確な操作（重要）:

- ユーザは「行を追加」ボタンを押すことで、予算明細（カテゴリの1行）を即座に追加できること。追加行はデフォルトで「種別=固定費、名前=空、ベース=空、補正列分は空」で挿入されること。
  - 追加した行は「行を削除」ボタンで削除可能であること。
- ユーザは「補正列を追加」ボタンを押すことで、補正予算の列をテーブルに1列追加できること。追加された補正列には任意のラベルを設定可能で、全行に空の入力欄が追加されること。
  - 追加した行は「補正列を削除」ボタンで削除可能であること。
 - 画面上に「策定済み予算取得ボタン」一覧を表示できること。各ボタンは「YYYY年M月」（例: 「2026年2月」「2026年3月」）の形式で表記され、各ボタンはその年月に策定済みの月次予算が存在する場合にのみ表示されること。
  - ユーザが該当の策定済み予算取得ボタン（例: 「2026年2月」）を押すと、サーバから当該年月の月次予算が取得され、フォーム（テーブル）に反映されて編集可能な状態になること。
  - 当該年月の予算が策定されていない場合は、その年月のボタン自体を表示しないこと。存在しない年月を選択してロードする操作は提供しない（新規作成は別操作で行う）。
- カテゴリ(つまり1行)ごとに、ベース予算と補正予算を合算した合計予算がリアルタイムで表示されること。合計予算は編集できず、表示のみであること。

- 収入-貯金目標を計算し「使えるお金」として表示すること。使えるお金から各カテゴリのベース予算と補正予算の合計を差し引いた「残額」も表示すること。残額が負の場合は明確に警告を表示すること。

- 補正列が多くなる場合は、テーブルは横スクロール可能であること。
  - 「種別」「カテゴリ名」「合計」「ベース」列は固定表示にして、補正列については左右にスクロールできるようにする。
  - その結果、列の名目表示が2列にわたったり、見切れたりしないようにして、視認性を上げる。

## レイアウト（デスクトップ・標準）

デスクトップ向けの標準レイアウトとして、編集ページは左右2カラム構成とします。左側カラムは主たる編集領域（収入・貯金目標・カテゴリテーブル・保存操作）を保持し、右側カラムは「保存済みの年月」一覧（縦並びのボタン）を表示します。目的は編集領域の幅を確保しつつ、過去の保存データへ素早くアクセスできるようにすることです。

振る舞い（要点）:
- 右カラムは保存済み年月のボタンを縦に並べ、各ボタンはカラム幅に合わせてフル幅で表示する。
- 左カラムはフォームとテーブルを含み、テーブルは横に広げられる場合に右カラムと並列表示される。狭い画面（モバイル）では右カラムは下部に回るか折りたたむ（簡易レスポンシブ対応）。
- 右カラムの各ボタンは押下で該当年月をサーバからロードし、左カラムのフォーム状態を置き換える（編集可能にする）。
  - ページ初回表示時に、保存済みデータが存在する場合は「最新の保存済み年月」を自動で読み込み、フォームに反映する。保存済みデータが無い場合のみ初期シード（CSV ベース）を表示する。

アクセシビリティ:
- 右カラムの領域に `aria-label="保存済み年月"` を付与する。
- 保存済み年月ボタンは明確なラベル（例: `2026年2月`）を持ち、キーボードフォーカス時に視認可能なアウトラインを示す。



## ユーザストーリー（要点）

- P1: ユーザは当月の収入と貯金目標を入力して月次予算を作成・確定できる。  
- P2: ユーザはカテゴリの作成・編集・削除を行える（種別は固定／変動）。  
- P3: ユーザはカテゴリごとに補正予算（名目＋金額）を追加できる。  
- P4: ユーザは過去の月次予算を一覧・参照できる。

## 受け入れ基準（測定可能）

1. ユーザが指定した年と月に対して、1つの月次予算が保存されること（同じ年/月で保存すると上書きされ、複数の重複レコードが作られない）。
2. 収入・貯金目標・各カテゴリのベース・補正（名目と金額）が保存・表示されること。
3. 過去月の内訳を選択してその内容を閲覧できること。
4. カテゴリは固定費／変動費のいずれかを指定でき、ベースは数値で指定できること。
5. ユーザが策定済み予算取得ボタン（例: 「2026年2月」）を押すと、その年月の保存済み月次予算がフォームにロードされ、すべての項目が編集可能になること。該当データが存在しない年月についてはそもそもボタンが表示されないこと。

## 非機能的な期待（大まか）

- ユーザ操作は直感的で、通常の操作フローで迷わないこと（UIはシンプルであること）。  
- 個人情報や入力データの取り扱いについては一般的な安全配慮を行うこと（必要に応じて保存ポリシーを定める）。

## UI の最小フロー（要旨）

1. ホーム画面: 過去の月次予算一覧の表示と「新規作成／編集」へ遷移するボタン。  
2. 作成画面: 収入、貯金目標、カテゴリ一覧（ベースの編集可）、補正予算の追加入力欄。  
3. 確認・保存: 作成内容を確認して確定（保存）する。  
4. 履歴画面: 過去月の内訳を一覧・参照できる。

## エッジケース（運用ルール）

- 収入 < 貯金目標: ユーザに警告を表示し、貯金目標の見直しを促す。  
- 利用可能額が負の場合は明確な警告を示す（例: 配分の見直しを促す）。  
- 補正の合計が利用可能額を超える場合は警告を表示する。

## 次のステップ（短期）

1. スペックのこの高レベル版をチームで合意する。  
2. 合意後、実装方針（実際に使うツールや保存方法）を別途決め、それを実装ドキュメントに記載する（実装文書は本スペックとは別に管理）。

---

作成者: speckit.specify（高レベル仕様）
